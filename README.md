# My Market App

Интернет-магазин на Spring Boot с корзиной и оформлением заказов.

## Стек

Java 21, Spring Boot 3.3.4, PostgreSQL 16, Thymeleaf, MapStruct, Lombok, Docker

## Как запустить

### Docker

```bash
docker-compose up --build
```

Откройте http://localhost:8080

### Без Docker

Нужны Java 21, Maven и PostgreSQL.

Создайте базу:
```sql
CREATE DATABASE my_market_db;
CREATE USER my_market_user WITH PASSWORD 'my_market_password';
GRANT ALL PRIVILEGES ON DATABASE my_market_db TO my_market_user;
```

Запустите:
```bash
mvn spring-boot:run
```

## Описание

Приложение представляет собой простой интернет-магазин с каталогом товаров. На главной странице отображается список товаров с изображениями, названиями, описаниями и ценами. Реализована пагинация - можно выбрать сколько товаров показывать на странице (от 2 до 100).

Есть поиск по товарам - ищет совпадения в названии и описании. Результаты можно сортировать по алфавиту или цене. При поиске и сортировке пагинация сохраняется.

У каждого товара есть кнопки + и - для добавления в корзину прямо из каталога. Текущее количество товара в корзине показывается рядом с кнопками. Если товара нет в корзине, отображается только кнопка "добавить в корзину".

Корзина работает в памяти приложения - все добавленные товары хранятся в HashMap. После перезапуска корзина очищается. В корзине можно изменять количество товаров или удалять их полностью. Внизу показывается общая сумма заказа.

При оформлении заказа создается запись в базе данных со всеми товарами и суммой. Корзина автоматически очищается. Все заказы доступны на странице истории с пагинацией. Можно открыть детали любого заказа и посмотреть что в нем было.

Изображения товаров хранятся в базе в виде BYTEA. При старте приложения автоматически загружаются SVG-файлы из папки static/images и сохраняются в таблицу item_images. Изображения отдаются по отдельному эндпоинту.

Схема базы данных создается из schema.sql при первом запуске. Тестовые данные (20 товаров) загружаются из data.sql. В проекте используется классическая трехслойная архитектура: контроллеры принимают HTTP-запросы, сервисы содержат бизнес-логику, репозитории работают с базой через Spring Data JPA.

Для маппинга между entity и DTO используется MapStruct - генерирует код маппинга на этапе компиляции. Lombok убирает boilerplate код в классах данных. Валидация входящих данных реализована через Jakarta Validation аннотации. Обработка ошибок централизована в GlobalExceptionHandler.

## API

- `/` - каталог товаров
- `/items/{id}` - карточка товара
- `/cart/items` - корзина
- `/orders` - история заказов
- `/orders/{id}` - детали заказа
- `/items/{id}/image` - изображение товара
- `/swagger-ui.html` - документация

Параметры пагинации: `pageNumber`, `pageSize`

Поиск: `?search=смартфон`

Сортировка: `?sort=ALPHA` или `?sort=PRICE` или `?sort=NO`
